<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport"
	content="initial-scale=1, maximum-scale=1,user-scalable=no" />
<title>操作地图界面</title>

<link rel="stylesheet"
	href="http://192.168.2.101:8080/arcgis_js_api_v3.21/library/3.21/3.21/dijit/themes/claro/claro.css">
<link rel="stylesheet"
	href="http://192.168.2.101:8080/arcgis_js_api_v3.21/library/3.21/3.21/esri/css/esri.css">
<style>
html, body, #map {
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
}
</style>

<script
	src="http://192.168.2.101:8080/arcgis_js_api_v3.21/library/3.21/3.21/init.js"></script>

<script>
	require(
			[ "esri/map", "esri/layers/FeatureLayer",
					"esri/dijit/FeatureTable", "dojo/parser",
					"dijit/layout/ContentPane", "dijit/layout/BorderContainer" ],
			function( Map, FeatureLayer, FeatureTable, parser,
					ContentPane, BorderContainer) {

				parser.parse();

				var map = new Map("map", {
					basemap : "dark-gray",

				});

				//Load a FeatureTable to the application once map loads
				map.on("load", loadTable);

				function loadTable() {

					// editable FeatureLayer
					var myFeatureLayer = new FeatureLayer(
							"http://192.168.2.144:6080/arcgis/rest/services/Learning/Polygon3/MapServer/0",
							{
								mode : FeatureLayer.MODE_ONDEMAND,
								outFields : [ "*" ],
								visible : true,
								id : "fLayer2"
							});

					// Redlands police vehicle locations layer
					// this layer is an editable layer 
					map.addLayer(myFeatureLayer);

					try {
						var mFeatureLayerTable = new FeatureTable({
							featureLayer : (myFeatureLayer),
							map : (this.map),
							editable : true,
							syncSelection : true,
							dateOptions : {
								datePattern : 'M/d/y',
								timeEnabled : true,
								timePattern : 'H:mm',
							},
							fieldInfos : [ {
								nanme : 'TBBH',
								alias : '图斑编号',
								editable : false
							}, {
								nanme : 'XMC',
								alias : 'XMC',
								format : {
									template : "${value} XMC"
								}
							}, {
								nanme : '调查人',
								alias : '调查人',
							} ],
							menuFunctions : [ {
								label : "Show All Emergency Vehicles",
								callback : function(evt) {
									console.log(" -- evt: ", evt);
									this.myFeatureLayer
											.setDefinitionExpression("1=1");
									mFeatureLayerTable.refresh();
								}
							} ]
						}, 'myTableNode');

						console
								.debug(" LeftToolBar_v3.21::showOrHideFeatureTable. mFeatureLayerTable="
										+ mFeatureLayerTable);

						mFeatureLayerTable.startup();

						// document.getElementById("bot").data-dojo-props="region:'center', splitter:false";

						mFeatureLayerTable.on("refresh", function(evt) {
							console.log("refresh event - ", evt);

						});
					} catch (err) {
						console.log(" showOrHideFeatureTable::" + err);
					}

				}
				dojo.byId("bot").set('region', 'top');
				// dijit.byId("bot").set("splitter", false);
				// dijit.byId("DetailsParent").resize();
			});
</script>
</head>
<body>




	<div id="DetailsParent" class="claro esri"
		data-dojo-type="dijit/layout/BorderContainer"
		data-dojo-props="design:'headline'" style="width: 100%; height: 100%;">
		<div data-dojo-type="dijit/layout/ContentPane"
			data-dojo-props="region:'center', splitter:true">
			<div id="map"></div>
		</div>
		<div id="bot" data-dojo-type="dijit/layout/ContentPane"
			data-dojo-props="region:'bottom'" style="height: 30%;">
			<div id="myTableNode"></div>
		</div>
	</div>


</body>
</html>
